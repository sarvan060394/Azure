 Delete Stale Pods API ‚Äì User Guide
‚úÖ Purpose
In large OpenShift clusters, many stale pods remain due to job completions, crashes, or other issues. These unused pods can clutter the system or take up unnecessary resources.

To fix this, we‚Äôve developed a "Delete Stale Pods API" ‚Äî a smart cleanup system that:

Lists stale pods by their status

Identifies pod ownership (ReplicaSet, Deployment, etc.)

Deletes safely, without breaking running applications

üë©‚Äçüíª How It Works (User Perspective)
As a user, you can:

Access the FastAPI Web UI

Select pod statuses you want to clean up:

Examples: CrashLoopBackOff, Completed, Error, Terminating, Pending, Evicted (All statuses supported)

Choose namespaces to target

The API automatically filters only non-prod namespaces based on the label: env_type=nonprod

Review the list of matching stale pods

Confirm deletion to start cleanup

The API will:

Trace pod ownership (RS/RC ‚Üí Deployment/DC)

Delete associated resources only if safe

Log everything clearly for traceability



üß¨ Key Logic Scenarios Handled
Case 1: Pod has no owner
The pod is not part of any controller.

Action: Pod is deleted directly.

Case 2: Pod is owned by a ReplicaSet or ReplicationController (no higher controller)
RS/RC manages the pod, but no Deployment or DC manages the RS/RC.

Action: Pod and RS/RC are both deleted.

Case 3: Pod is owned by ReplicaSet ‚Üí Deployment
If the Deployment still has healthy running pods:

Skip deletion to avoid breaking the app

If no other pods are running:

Delete the Deployment

Delete the RS

Delete the pod

Case 4: Multiple stale pods from the same Deployment
Only one delete operation is triggered for the Deployment.

Duplicates are tracked and skipped using in-memory sets.

Avoids noisy Kubernetes errors like 404 Not Found

 Key Challenges & Bottlenecks
1. Complex Ownership Chains
In Kubernetes, pods are often part of a chain:

scss
Copy
Edit
Pod ‚Üí ReplicaSet ‚Üí Deployment (or Pod ‚Üí RC ‚Üí DC)
The API navigates this chain automatically, so users don‚Äôt have to.

